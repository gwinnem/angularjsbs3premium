"use strict";function isVertical(e){return void 0!==e._view.width}function getBarBounds(e){var t=e._view,a=t.width/2,l=t.x-a,n=t.x+a;return{left:l,top:t.candle.h,right:n,bottom:t.candle.l}}var helpers=Chart.helpers,globalOpts=Chart.defaults.global,defaultColor=globalOpts.defaultColor;globalOpts.elements.candlestick={upCandleColor:"rgba(80, 160, 115, 1)",downCandleColor:"rgba(215, 85, 65, 1)",outlineCandleColor:"rgba(90, 90, 90, 1)",outlineCandleWidth:1},Chart.elements.Candlestick=Chart.Element.extend({draw:function(){var e=this._chart.ctx,t=this._view,a=(t.borderWidth,t.x),l=t.candle.o,n=t.candle.h,i=t.candle.l,r=t.candle.c;e.strokeStyle=helpers.getValueOrDefault(t.outlineCandleColor,globalOpts.elements.candlestick.outlineCandleColor),e.lineWidth=helpers.getValueOrDefault(t.outlineCandleWidth,globalOpts.elements.candlestick.outlineCandleWidth),e.fillStyle=r<l?helpers.getValueOrDefault(t.upCandleColor,globalOpts.elements.candlestick.upCandleColor):r>l?helpers.getValueOrDefault(t.downCandleColor,globalOpts.elements.candlestick.downCandleColor):helpers.getValueOrDefault(t.outlineCandleColor,globalOpts.elements.candlestick.outlineCandleColor),e.beginPath(),e.moveTo(a,n),e.lineTo(a,i),e.stroke(),e.fillRect(a-t.width/2,r,t.width,l-r),e.strokeRect(a-t.width/2,r,t.width,l-r),e.closePath()},height:function(){var e=this._view;return e.base-e.y},inRange:function(e,t){var a=!1;if(this._view){var l=getBarBounds(this);a=e>=l.left&&e<=l.right&&t>=l.top&&t<=l.bottom}return a},inLabelRange:function(e,t){var a=this;if(!a._view)return!1;var l=getBarBounds(a);return isVertical(a)?e>=l.left&&e<=l.right:t>=l.top&&t<=l.bottom},inXRange:function(e){var t=getBarBounds(this);return e>=t.left&&e<=t.right},inYRange:function(e){var t=getBarBounds(this);return e>=t.top&&e<=t.bottom},getCenterPoint:function(){var e=this._view,t=e.width/2;return{x:e.x-t,y:(e.candle.h+e.candle.l)/2}},getArea:function(){var e=this._view;return e.width*Math.abs(e.y-e.base)},tooltipPosition:function(){var e=this._view;return{x:e.x,y:(e.candle.h+e.candle.l)/2}}});var helpers=Chart.helpers,defaultConfig={position:"left",ticks:{callback:function(e,t,a){var l=a.length>3?a[2]-a[1]:a[1]-a[0];Math.abs(l)>1&&e!==Math.floor(e)&&(l=e-Math.floor(e));var n=helpers.log10(Math.abs(l)),i="";if(0!==e){var r=-1*Math.floor(n);r=Math.max(Math.min(r,20),0),i=e.toFixed(r)}else i="0";return i}}},FinancialLinearScale=Chart.scaleService.getScaleConstructor("linear").extend({determineDataLimits:function(){function e(e){return n?e.xAxisID===t.id:e.yAxisID===t.id}var t=this,a=t.chart,l=a.data.datasets,n=t.isHorizontal();t.min=null,t.max=null,helpers.each(l,function(l,n){var i=a.getDatasetMeta(n);a.isDatasetVisible(n)&&e(i)&&helpers.each(l.data,function(e,a){var l=e.h,n=e.l;null===t.min?t.min=n:n<t.min&&(t.min=n),null===t.max?t.max=l:l>t.max&&(t.max=l)})});var i=.05*(t.max-t.min);t.min-=i,t.max+=i,this.handleTickRangeOptions()}});Chart.scaleService.registerScaleType("financialLinear",FinancialLinearScale,defaultConfig),Chart.defaults.financial={label:"",hover:{mode:"label"},scales:{xAxes:[{type:"time",distribution:"series",categoryPercentage:.8,barPercentage:.9,time:{format:"ll"},ticks:{source:"data"}}],yAxes:[{type:"financialLinear"}]},tooltips:{callbacks:{label:function(e,t){return" O "+t.datasets[e.datasetIndex].data[e.index].o+" H "+t.datasets[e.datasetIndex].data[e.index].h+" L "+t.datasets[e.datasetIndex].data[e.index].l+" C "+t.datasets[e.datasetIndex].data[e.index].c}}}},Chart.controllers.financial=Chart.controllers.bar.extend({dataElementType:Chart.elements.Candlestick,updateElement:function(e,t,a){var l=this,n=(l.chart,l.getMeta()),i=l.getDataset();e.custom;e._xScale=l.getScaleForId(n.xAxisID),e._yScale=l.getScaleForId(n.yAxisID),e._datasetIndex=l.index,e._index=t,e._model={datasetLabel:i.label||"",upCandleColor:i.upCandleColor,downCandleColor:i.downCandleColor,outlineCandleColor:i.outlineCandleColor,outlineCandleWidth:i.outlineCandleWidth},l.updateElementGeometry(e,t,a),e.pivot()},updateElementGeometry:function(e,t,a){var l=this,n=e._model,i=l.getValueScale(),r=i.getBasePixel(),o=i.isHorizontal(),s=l._ruler||l.getRuler(),d=l.calculateBarValuePixels(l.index,t),c=l.calculateBarIndexPixels(l.index,t,s);n.horizontal=o,n.base=a?r:d.base,n.x=o?a?r:d.head:c.center,n.y=o?c.center:a?r:d.head,n.height=o?c.size:void 0,n.width=o?void 0:c.size,n.candle=l.calculateCandleValuesPixels(l.index,t)},calculateCandleValuesPixels:function(e,t){var a=this,l=a.chart,n=a.getValueScale(),i=l.data.datasets;return{o:n.getPixelForValue(Number(i[e].data[t].o)),h:n.getPixelForValue(Number(i[e].data[t].h)),l:n.getPixelForValue(Number(i[e].data[t].l)),c:n.getPixelForValue(Number(i[e].data[t].c))}},draw:function(){var e,t=this.chart.chart.ctx,a=this.getMeta().data,l=this.getDataset(),n=a.length,i=0;for(Chart.canvasHelpers.clipArea(t,this.chart.chartArea);i<n;++i)null===(e=l.data[i].o)||void 0===e||isNaN(e)||a[i].draw();Chart.canvasHelpers.unclipArea(t)}});